


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>enaml.core.enaml_compiler &mdash; enaml 0.2beta-1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/enthought_doc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2beta-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/et.ico"/>
    <link rel="top" title="enaml 0.2beta-1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../enaml-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">enaml 0.2beta-1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li>
  
    <li><a href="#">enaml.core.enaml_compiler</a></li>
  

      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/e-logo-rev.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for enaml.core.enaml_compiler</h1><div class="highlight"><pre>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="c">#  Copyright (c) 2011, Enthought, Inc.</span>
<span class="c">#  All rights reserved.</span>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="kn">from</span> <span class="nn">.byteplay</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Code</span><span class="p">,</span> <span class="n">LOAD_FAST</span><span class="p">,</span> <span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="n">LOAD_GLOBAL</span><span class="p">,</span> <span class="n">STORE_FAST</span><span class="p">,</span> <span class="n">LOAD_CONST</span><span class="p">,</span>
    <span class="n">LOAD_ATTR</span><span class="p">,</span> <span class="n">STORE_SUBSCR</span><span class="p">,</span> <span class="n">RETURN_VALUE</span><span class="p">,</span> <span class="n">POP_TOP</span><span class="p">,</span> <span class="n">MAKE_FUNCTION</span><span class="p">,</span>
    <span class="n">STORE_NAME</span><span class="p">,</span> <span class="n">LOAD_NAME</span><span class="p">,</span> <span class="n">SetLineno</span><span class="p">,</span>
<span class="p">)</span>


<span class="c"># Increment this number whenever the compiler changes the code which it</span>
<span class="c"># generates. This number is used by the import hooks to know which version</span>
<span class="c"># of a .enamlc file is valid for the Enaml compiler version in use. If </span>
<span class="c"># this number is not incremented on change, it may result in .enamlc</span>
<span class="c"># files which fail on import.</span>
<span class="c">#</span>
<span class="c"># Version History</span>
<span class="c"># ---------------</span>
<span class="c"># 1 : Initial compiler version - 2 February 2012</span>
<span class="c"># 2 : Update line number handling - 26 March 2012</span>
<span class="c">#     When compiling code objects with mode=&#39;eval&#39;, Python ignores the </span>
<span class="c">#     line number specified by the ast. The workaround is to compile the </span>
<span class="c">#     code object, then make a new copy of it with the proper firstlineno </span>
<span class="c">#     set via the types.CodeType constructor.</span>
<span class="n">COMPILER_VERSION</span> <span class="o">=</span> <span class="mi">2</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Compiler Helpers</span>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Code that will be executed at the top of every enaml module</span>
<span class="n">STARTUP</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;from enaml.core.factory import EnamlDeclaration&#39;</span><span class="p">]</span>


<span class="c"># Cleanup code that will be included in every compiled enaml module</span>
<span class="n">CLEANUP</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;del EnamlDeclaration&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_var_name_generator</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a generator that generates sequential variable names for</span>
<span class="sd">    use in a code block.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="s">&#39;_var_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>


<div class="viewcode-block" id="update_firstlineno"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.update_firstlineno">[docs]</a><span class="k">def</span> <span class="nf">update_firstlineno</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">firstlineno</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a new code object with an updated first line number.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">CodeType</span><span class="p">(</span>
        <span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_nlocals</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_stacksize</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_flags</span><span class="p">,</span>
        <span class="n">code</span><span class="o">.</span><span class="n">co_code</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_consts</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_names</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">,</span>
        <span class="n">code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">firstlineno</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_lnotab</span><span class="p">,</span> 
        <span class="n">code</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">co_cellvars</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Node Visitor</span>
<span class="c">#------------------------------------------------------------------------------</span></div>
<span class="k">class</span> <span class="nc">_NodeVisitor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A node visitor class that is used as base class for the various</span>
<span class="sd">    Enaml compilers.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  The main visitor dispatch method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;visit_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">node</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_visit</span>
        <span class="n">method</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">default_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The default visitor method. Raises an error since there </span>
<span class="sd">        should not be any unhandled nodes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unhandled Node </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="n">node</span><span class="p">)</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Declaration Compiler</span>
<span class="c">#------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="DeclarationCompiler"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler">[docs]</a><span class="k">class</span> <span class="nc">DeclarationCompiler</span><span class="p">(</span><span class="n">_NodeVisitor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A visitor which compiles a Declaration node into a code object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DeclarationCompiler.compile"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compiles the given Declaration node into a byteplay code </span>
<span class="sd">        object.</span>

<span class="sd">        Given this sample declaration in Enaml::</span>
<span class="sd">          </span>
<span class="sd">        FooWindow(Window):</span>
<span class="sd">            id: foo</span>
<span class="sd">            a = &#39;12&#39;</span>
<span class="sd">            PushButton:</span>
<span class="sd">                id: btn</span>
<span class="sd">                text = &#39;clickme&#39;</span>
<span class="sd">        </span>
<span class="sd">        We generate bytecode that would correspond to a Python function that</span>
<span class="sd">        looks similar to this::</span>
<span class="sd">        </span>
<span class="sd">        def FooWindow(identifiers, toolkit):</span>
<span class="sd">            f_globals = globals()</span>
<span class="sd">            eval_ = eval</span>
<span class="sd">            foo_cls = eval(&#39;Window&#39;, toolkit, f_globals)</span>
<span class="sd">            foo = foo_cls.__enaml_call__(identifiers, toolkit)</span>
<span class="sd">            identifiers[&#39;foo&#39;] = foo</span>
<span class="sd">            op = eval_(&#39;__operator_Equal__&#39;, toolkit, f_globals)</span>
<span class="sd">            op(foo, &#39;a&#39;, &lt;ast&gt;, &lt;code&gt;, identifiers, f_globals, toolkit)</span>
<span class="sd">            btn_cls = eval_(&#39;PushButton&#39;, toolkit, f_globals)</span>
<span class="sd">            btn = btn_cls.__enaml_call__(None, toolkit)</span>
<span class="sd">            identifiers[&#39;btn&#39;] = button</span>
<span class="sd">            op = eval_(&#39;__operator_Equal__&#39;, toolkit, f_globals)</span>
<span class="sd">            op(item, &#39;text&#39;, &lt;ast&gt;, &lt;code&gt;, identifiers, f_globals, toolkit)</span>
<span class="sd">            foo.add_subcomponent(button)</span>
<span class="sd">            return foo</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">compiler</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">code_ops</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">code_ops</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">Code</span><span class="p">(</span>
            <span class="n">code_ops</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s">&#39;identifiers&#39;</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span>
</div>
<div class="viewcode-block" id="DeclarationCompiler.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extend_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code_ops</span><span class="o">.</span><span class="n">extend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_gen</span> <span class="o">=</span> <span class="n">_var_name_generator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_stack</span><span class="o">.</span><span class="n">append</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_stack</span><span class="o">.</span><span class="n">pop</span>
</div>
<div class="viewcode-block" id="DeclarationCompiler.curr_name"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.curr_name">[docs]</a>    <span class="k">def</span> <span class="nf">curr_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the current variable name on the stack.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="DeclarationCompiler.visit_Declaration"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.visit_Declaration">[docs]</a>    <span class="k">def</span> <span class="nf">visit_Declaration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the bytecode ops for a declaration node. This visitor</span>
<span class="sd">        handles creating the component instance and storing it&#39;s identifer</span>
<span class="sd">        if one is given.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">extend_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_ops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">base_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">py_ast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;eval&#39;</span><span class="p">)</span>
        <span class="n">extend_ops</span><span class="p">([</span>
            <span class="c"># f_globals = globals()</span>
            <span class="p">(</span><span class="n">LOAD_GLOBAL</span><span class="p">,</span> <span class="s">&#39;globals&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">),</span>
            <span class="p">(</span><span class="n">STORE_FAST</span><span class="p">,</span> <span class="s">&#39;f_globals&#39;</span><span class="p">),</span>

            <span class="c"># eval_ = eval</span>
            <span class="p">(</span><span class="n">LOAD_GLOBAL</span><span class="p">,</span> <span class="s">&#39;eval&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">STORE_FAST</span><span class="p">,</span> <span class="s">&#39;eval_&#39;</span><span class="p">),</span>

            <span class="c"># foo_cls = eval(&#39;Window&#39;, toolkit, f_globals)</span>
            <span class="c"># foo = foo_cls.__enaml_call__(identifiers, toolkit)</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;eval_&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">base_code</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;f_globals&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_ATTR</span><span class="p">,</span> <span class="s">&#39;__enaml_call__&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;identifiers&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">),</span>
            <span class="p">(</span><span class="n">STORE_FAST</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
            <span class="n">extend_ops</span><span class="p">([</span>
                <span class="c"># identifiers[&#39;foo&#39;] = foo</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;identifiers&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="p">),</span>
                <span class="p">(</span><span class="n">STORE_SUBSCR</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">])</span>
        
        <span class="n">visit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="n">visit</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        
        <span class="n">extend_ops</span><span class="p">([</span>
            <span class="c"># return foo</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">RETURN_VALUE</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_name</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DeclarationCompiler.visit_AttributeDeclaration"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.visit_AttributeDeclaration">[docs]</a>    <span class="k">def</span> <span class="nf">visit_AttributeDeclaration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the bytecode ops for an attribute declaration. This</span>
<span class="sd">        visitor handles adding a new attribute to a component.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extend_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_ops</span>

        <span class="c"># Load the method that&#39;s going to be called and the</span>
        <span class="c"># name of the attribute being declared.</span>
        <span class="n">extend_ops</span><span class="p">([</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_name</span><span class="p">()),</span>
            <span class="p">(</span><span class="n">LOAD_ATTR</span><span class="p">,</span> <span class="s">&#39;add_attribute&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c"># Generate the ops to the load the type (if one was given),</span>
        <span class="c"># and the call the add_attribute method</span>
        <span class="n">node_type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">node_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">type_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">node_type</span><span class="o">.</span><span class="n">py_ast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;eval&#39;</span><span class="p">)</span>
            <span class="n">extend_ops</span><span class="p">([</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;eval_&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">type_code</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;f_globals&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">is_event</span><span class="p">),</span>
                <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">),</span>
                <span class="p">(</span><span class="n">POP_TOP</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extend_ops</span><span class="p">([</span>
                <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="s">&#39;is_event&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">is_event</span><span class="p">),</span>
                <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0101</span><span class="p">),</span>
                <span class="p">(</span><span class="n">POP_TOP</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">])</span>

        <span class="c"># Visit the default attribute binding if one exists.</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">default</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DeclarationCompiler.visit_AttributeBinding"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.visit_AttributeBinding">[docs]</a>    <span class="k">def</span> <span class="nf">visit_AttributeBinding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates the bytecode ops for an attribute binding. This</span>
<span class="sd">        visitor handles loading and calling the appropriate operator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># A binding is accomplished by loading the appropriate binding</span>
        <span class="c"># operator function and passing it the a number of arguments:</span>
        <span class="c">#</span>
        <span class="c"># op = eval(&#39;__operator_Equal__&#39;, toolkit, f_globals)</span>
        <span class="c"># op(item, &#39;a&#39;, code, identifiers, f_globals, toolkit)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">op_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">binding</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;eval&#39;</span><span class="p">)</span>
        <span class="n">py_ast</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">binding</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">py_ast</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">py_ast</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
            <span class="n">expr_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">py_ast</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># When compiling in &#39;eval&#39; mode, the line number in the ast</span>
            <span class="c"># gets ignored. We need to make new code object from this</span>
            <span class="c"># on with the proper starting line number so that </span>
            <span class="c"># exceptions are properly reported.</span>
            <span class="n">expr_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">py_ast</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;eval&#39;</span><span class="p">)</span>
            <span class="n">expr_code</span> <span class="o">=</span> <span class="n">update_firstlineno</span><span class="p">(</span><span class="n">expr_code</span><span class="p">,</span> <span class="n">py_ast</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extend_ops</span><span class="p">([</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;eval_&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">op_code</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;f_globals&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_name</span><span class="p">()),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">expr_code</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;identifiers&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;f_globals&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0006</span><span class="p">),</span>
            <span class="p">(</span><span class="n">POP_TOP</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">])</span>
</div>
<div class="viewcode-block" id="DeclarationCompiler.visit_Instantiation"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.DeclarationCompiler.visit_Instantiation">[docs]</a>    <span class="k">def</span> <span class="nf">visit_Instantiation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create the bytecode ops for a component instantiation. This </span>
<span class="sd">        visitor handles calling another derived component and storing</span>
<span class="sd">        its identifier, if given.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extend_ops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_ops</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">op_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;eval&#39;</span><span class="p">)</span>
        <span class="n">extend_ops</span><span class="p">([</span>
            <span class="c"># btn_cls = eval(&#39;PushButton&#39;, toolkit, f_globals)</span>
            <span class="c"># btn = btn_cls.__enaml_call__(None, toolkit)</span>
            <span class="c"># When instantiating a Declaration, it is called without</span>
            <span class="c"># identifiers, so that it creates it&#39;s own new identifiers</span>
            <span class="c"># scope. This means that derived declarations share ids,</span>
            <span class="c"># but the composed children have an isolated id space.</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;eval_&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">op_code</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;f_globals&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_ATTR</span><span class="p">,</span> <span class="s">&#39;__enaml_call__&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;toolkit&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">),</span>
            <span class="p">(</span><span class="n">STORE_FAST</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
        <span class="p">])</span>
        
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
            <span class="n">extend_ops</span><span class="p">([</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="s">&#39;identifiers&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="p">),</span>
                <span class="p">(</span><span class="n">STORE_SUBSCR</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">])</span>

        <span class="n">visit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="n">visit</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_name</span><span class="p">()</span>
        <span class="n">extend_ops</span><span class="p">([</span>
            <span class="c"># foo.add_subcomponent(button)</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_name</span><span class="p">()),</span>
            <span class="p">(</span><span class="n">LOAD_ATTR</span><span class="p">,</span> <span class="s">&#39;add_subcomponent&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_FAST</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">),</span>
            <span class="p">(</span><span class="n">POP_TOP</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">])</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Enaml Compiler</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="EnamlCompiler"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.EnamlCompiler">[docs]</a><span class="k">class</span> <span class="nc">EnamlCompiler</span><span class="p">(</span><span class="n">_NodeVisitor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A compiler that will compile an enaml module ast node.</span>
<span class="sd">    </span>
<span class="sd">    The entry point is the `compile` classmethod which will compile</span>
<span class="sd">    the ast into an appropriate python object and place the results </span>
<span class="sd">    in the provided module dictionary.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="EnamlCompiler.compile"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.EnamlCompiler.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">module_ast</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main entry point of the compiler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        module_ast : Instance(enaml_ast.Module)</span>
<span class="sd">            The enaml module ast node that should be compiled.</span>
<span class="sd">        </span>
<span class="sd">        module_dict : dict</span>
<span class="sd">            The dictionary of the Python module into which we are</span>
<span class="sd">            compiling the enaml code.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">compiler</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">module_ast</span><span class="p">)</span>

        <span class="n">module_ops</span> <span class="o">=</span> <span class="p">[(</span><span class="n">SetLineno</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">extend_ops</span> <span class="o">=</span> <span class="n">module_ops</span><span class="o">.</span><span class="n">extend</span>

        <span class="c"># Generate the startup code for the module</span>
        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">STARTUP</span><span class="p">:</span>
            <span class="n">start_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>
            <span class="c"># Skip the SetLineo and ReturnValue codes</span>
            <span class="n">extend_ops</span><span class="p">(</span><span class="n">Code</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="n">start_code</span><span class="p">)</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

        <span class="c"># Add in the code ops for the module</span>
        <span class="n">extend_ops</span><span class="p">(</span><span class="n">compiler</span><span class="o">.</span><span class="n">code_ops</span><span class="p">)</span>

        <span class="c"># Generate the cleanup code for the module</span>
        <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">CLEANUP</span><span class="p">:</span>
            <span class="n">end_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>
            <span class="c"># Skip the SetLineo and ReturnValue codes</span>
            <span class="n">extend_ops</span><span class="p">(</span><span class="n">Code</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="n">end_code</span><span class="p">)</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="c"># Add in the final return value ops</span>
        <span class="n">extend_ops</span><span class="p">([</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="n">RETURN_VALUE</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c"># Generate and return the module code object.</span>
        <span class="n">mod_code</span> <span class="o">=</span> <span class="n">Code</span><span class="p">(</span>
            <span class="n">module_ops</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>  <span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">mod_code</span><span class="o">.</span><span class="n">to_code</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="EnamlCompiler.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.EnamlCompiler.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</div>
<div class="viewcode-block" id="EnamlCompiler.visit_Module"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.EnamlCompiler.visit_Module">[docs]</a>    <span class="k">def</span> <span class="nf">visit_Module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The module node visitor method. Used internally by the</span>
<span class="sd">        compiler.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="EnamlCompiler.visit_Python"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.EnamlCompiler.visit_Python">[docs]</a>    <span class="k">def</span> <span class="nf">visit_Python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A visitor which adds a chunk of raw Python into the module.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This compiles the given Python ast into a Python code object</span>
        <span class="c"># then disassembles it into a byteplay code object. This allows</span>
        <span class="c"># us to interleave the instructions with those generated for</span>
        <span class="c"># the rest of the module and then compile a single unified </span>
        <span class="c"># code object.</span>
        <span class="n">py_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">py_ast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">bpc</span> <span class="o">=</span> <span class="n">Code</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="n">py_code</span><span class="p">)</span>
        <span class="c"># Skip the SetLineo and ReturnValue codes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_ops</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bpc</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="EnamlCompiler.visit_Declaration"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.enaml_compiler.EnamlCompiler.visit_Declaration">[docs]</a>    <span class="k">def</span> <span class="nf">visit_Declaration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The declaration node visitor. This will add an instance</span>
<span class="sd">        of EnamlDeclaration to the module.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This creates a function from the generated code ops then</span>
        <span class="c"># wraps that function in an EnamlDeclaration.</span>
        <span class="n">func_code</span> <span class="o">=</span> <span class="n">DeclarationCompiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_ops</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="p">(</span><span class="n">LOAD_CONST</span><span class="p">,</span> <span class="n">func_code</span><span class="p">),</span>
            <span class="p">(</span><span class="n">MAKE_FUNCTION</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="n">STORE_NAME</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_NAME</span><span class="p">,</span> <span class="s">&#39;EnamlDeclaration&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">LOAD_NAME</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">CALL_FUNCTION</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">),</span>
            <span class="p">(</span><span class="n">STORE_NAME</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
        <span class="p">])</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../enaml-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">enaml 0.2beta-1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
  
    <li><a href="#">enaml.core.enaml_compiler</a></li>
  

      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Enthought, Inc..
      Last updated on May 23, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>