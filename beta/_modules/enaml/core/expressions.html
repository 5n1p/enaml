


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>enaml.core.expressions &mdash; enaml 0.3alpha documentation</title>
    
    <link rel="stylesheet" href="../../../_static/enthought_doc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/et.ico"/>
    <link rel="top" title="enaml 0.3alpha documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../enaml-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">enaml 0.3alpha documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li>
  
    <li><a href="#">enaml.core.expressions</a></li>
  

      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/e-logo-rev.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for enaml.core.expressions</h1><div class="highlight"><pre>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="c">#  Copyright (c) 2011, Enthought, Inc.</span>
<span class="c">#  All rights reserved.</span>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">ref</span>

<span class="kn">from</span> <span class="nn">traits.api</span> <span class="kn">import</span> <span class="n">Disallow</span>

<span class="kn">from</span> <span class="nn">.byteplay</span> <span class="kn">import</span> <span class="n">Code</span>
<span class="kn">from</span> <span class="nn">.monitors</span> <span class="kn">import</span> <span class="n">AbstractMonitor</span>
<span class="kn">from</span> <span class="nn">.signaling</span> <span class="kn">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">.trait_types</span> <span class="kn">import</span> <span class="n">UninitializedAttributeError</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Expression Helpers</span>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="nd">@contextmanager</span>
<div class="viewcode-block" id="swap_attribute"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.swap_attribute">[docs]</a><span class="k">def</span> <span class="nf">swap_attribute</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Swap an attribute of an object with the given value for the </span>
<span class="sd">    duration of the context, restoring it on exit. The attribute must</span>
<span class="sd">    already exist on the object prior to entering the context.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : object</span>
<span class="sd">        The object which owns the attribute.</span>
<span class="sd">    </span>
<span class="sd">    attr : string</span>
<span class="sd">        The name of the attribute on the object.</span>

<span class="sd">    value : object</span>
<span class="sd">        The value to apply to the attribute for the duration of the</span>
<span class="sd">        context.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Execution Scope</span>
<span class="c">#------------------------------------------------------------------------------</span></div>
<div class="viewcode-block" id="ExecutionScope"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.ExecutionScope">[docs]</a><span class="k">class</span> <span class="nc">ExecutionScope</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A custom mapping object that implements the scope resolution </span>
<span class="sd">    order for the evaluation of code objects in Enaml expressions.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Strong references are kept to all objects passed to the constructor,</span>
<span class="sd">    so these scope objects should be created as needed and discarded in</span>
<span class="sd">    order to avoid issues with reference cycles.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ExecutionScope.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.ExecutionScope.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">,</span> <span class="n">overrides</span><span class="p">,</span> <span class="n">attr_cb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize an execution scope.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Declarative</span>
<span class="sd">            The Declarative instance on which the expression is bound.</span>

<span class="sd">        identifiers : dict</span>
<span class="sd">            The dictionary of identifiers that are available to the</span>
<span class="sd">            expression. These are checked before the attribute space</span>
<span class="sd">            of the component.</span>

<span class="sd">        overrides : dict</span>
<span class="sd">            An dictionary of override values to check before identifiers.</span>

<span class="sd">        attr_cb : callable or None</span>
<span class="sd">            A callable which is called when an implicit attribute is </span>
<span class="sd">            found and accessed on the object. The arguments passed are </span>
<span class="sd">            the object and the attribute name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_identifiers</span> <span class="o">=</span> <span class="n">identifiers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overrides</span> <span class="o">=</span> <span class="n">overrides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attr_cb</span> <span class="o">=</span> <span class="n">attr_cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assignments</span> <span class="o">=</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="ExecutionScope.__getitem__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.ExecutionScope.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lookup an item from the namespace.</span>

<span class="sd">        Returns the named item from the namespace according to the</span>
<span class="sd">        following precedence rules:</span>

<span class="sd">            1) assignments</span>
<span class="sd">            2) override</span>
<span class="sd">            3) identifiers</span>
<span class="sd">            4) implicit attrs</span>
<span class="sd">            5) f_globals</span>
<span class="sd">            6) toolkit</span>
<span class="sd">            7) builtins</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : string</span>
<span class="sd">            The name that should be looked up in the namespace.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : object</span>
<span class="sd">            The value associated with the name, if found.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError : Exception</span>
<span class="sd">            If the name is not found, a KeyError is raised.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check the assignments dict first since this is where all</span>
        <span class="c"># local variable assignments will be stored.</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assignments</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dct</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c"># The overrides have the highest precedence of all framework</span>
        <span class="c"># supplied values.</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overrides</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dct</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        
        <span class="c"># Identifiers have the highest precedence of value able to</span>
        <span class="c"># be supplied by a user of the framework.</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifiers</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dct</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c"># After identifiers, the implicit attributes of the component</span>
        <span class="c"># hierarchy have precedence.</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Call the attribute callback if given.</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_cb</span>
                <span class="k">if</span> <span class="n">cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">cb</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">res</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExecutionScope.__setitem__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.ExecutionScope.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Stores the value into the internal assignments dict. This </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assignments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="ExecutionScope.__delitem__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.ExecutionScope.__delitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Deletes the value from the internal assignments dict.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assignments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ExecutionScope.__contains__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.ExecutionScope.__contains__">[docs]</a>    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if the name is found in the scope, False </span>
<span class="sd">        otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># This method must be supplied in order for pdb to work properly</span>
        <span class="c"># from within code blocks. Any attribute callback is temporarily</span>
        <span class="c"># uninstalled so that it is not executed when simply checking for</span>
        <span class="c"># the existance of the item in the scope.</span>
        <span class="k">with</span> <span class="n">swap_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_attr_cb&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">res</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Nonlocal Scope</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="NonlocalScope"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope">[docs]</a><span class="k">class</span> <span class="nc">NonlocalScope</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; An object which implements implicit attribute scoping starting</span>
<span class="sd">    at a given object in the tree. It is used in conjuction with a </span>
<span class="sd">    nonlocals() instance to allow for explicit referencing of values</span>
<span class="sd">    which would otherwise be implicitly scoped.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="NonlocalScope.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr_cb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a nonlocal scope.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Declarative</span>
<span class="sd">            The Declarative instance which forms the first level of</span>
<span class="sd">            the scope.</span>
<span class="sd">        </span>
<span class="sd">        attr_cb : callable or None</span>
<span class="sd">            A callable which is called when an implicit attribute is </span>
<span class="sd">            found and accessed on the object. The arguments passed are </span>
<span class="sd">            the object and the attribute name.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nls_obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nls_attr_cb</span> <span class="o">=</span> <span class="n">attr_cb</span>
</div>
<div class="viewcode-block" id="NonlocalScope.__repr__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A pretty representation of the NonlocalScope.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">templ</span> <span class="o">=</span> <span class="s">&#39;NonlocalScope[</span><span class="si">%s</span><span class="s">]&#39;</span>
        <span class="k">return</span> <span class="n">templ</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nls_obj</span>
</div>
<div class="viewcode-block" id="NonlocalScope.__call__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a new nonlocal scope object offset the given number</span>
<span class="sd">        of levels in the hierarchy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level : int, optional</span>
<span class="sd">            The number of levels up the tree to offset. The default is</span>
<span class="sd">            zero and indicates no offset. The level must be &gt;= 0.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;The nonlocal scope level must be an int &gt;= 0. &#39;</span>
                   <span class="s">&#39;Got </span><span class="si">%r</span><span class="s"> instead.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">level</span><span class="p">)</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nls_obj</span>
        <span class="k">while</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">offset</span> <span class="o">!=</span> <span class="n">level</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="n">level</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Scope level </span><span class="si">%s</span><span class="s"> is out of range&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">level</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NonlocalScope</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nls_attr_cb</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NonlocalScope.__getattr__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__getattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A convenience method which allows accessing items in the</span>
<span class="sd">        scope via getattr instead of getitem.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> has no attribute &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NonlocalScope.__setattr__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__setattr__">[docs]</a>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A convenience method which allows setting items in the </span>
<span class="sd">        scope via setattr instead of setitem.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;_nls_obj&#39;</span><span class="p">,</span> <span class="s">&#39;_nls_attr_cb&#39;</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NonlocalScope</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> has no attribute &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NonlocalScope.__getitem__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the named item beginning at the current scope object</span>
<span class="sd">        and progressing up the tree until the named attribute is found.</span>
<span class="sd">        A KeyError is raised if the attribute is not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nls_obj</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nls_attr_cb</span>
                <span class="k">if</span> <span class="n">cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">cb</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">res</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="NonlocalScope.__setitem__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the value of the scope by beginning at the current scope</span>
<span class="sd">        object and progressing up the tree until the named attribute is </span>
<span class="sd">        found. A KeyError is raise in the attribute is not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nls_obj</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># It&#39;s not sufficient to try to do setattr(...) here and </span>
            <span class="c"># catch the AttributeError, because HasStrictTraits raises</span>
            <span class="c"># a TraitError in these cases and it becomes impossible</span>
            <span class="c"># to distinguish that error from a trait typing error </span>
            <span class="c"># without checking the message of the exception.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UninitializedAttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">continue</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NonlocalScope.__contains__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NonlocalScope.__contains__">[docs]</a>    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if the name is found in the scope, False </span>
<span class="sd">        otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">swap_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_nls_attr_cb&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">res</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Abstract Expression</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="AbstractExpression"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.AbstractExpression">[docs]</a><span class="k">class</span> <span class="nc">AbstractExpression</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The base abstract expression class which defines the base api</span>
<span class="sd">    for Expression handlers. These objects are typically created by</span>
<span class="sd">    the Enaml operators.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="c">#: A signal which is emitted when the expression has changed. It is</span>
    <span class="c">#: emmitted with three arguments: expression, name, and value; where </span>
    <span class="c">#: expression is the instance which emitted the signal, name is the </span>
    <span class="c">#: attribute name to which the expression is bound, and value is the</span>
    <span class="c">#: computed value of the expression.</span>
    <span class="n">expression_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

<div class="viewcode-block" id="AbstractExpression.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.AbstractExpression.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">,</span> <span class="n">f_globals</span><span class="p">,</span> <span class="n">operators</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes and expression object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Declarative</span>
<span class="sd">            The base component to which this expression is being bound.</span>

<span class="sd">        name : string</span>
<span class="sd">            The name of the attribute on the owner to which this </span>
<span class="sd">            expression is bound.</span>

<span class="sd">        code : types.CodeType object</span>
<span class="sd">            The compiled code object for the Python expression.</span>

<span class="sd">        identifiers : dict</span>
<span class="sd">            The dictionary of identifiers that are available to the</span>
<span class="sd">            expression.</span>

<span class="sd">        f_globals : dict</span>
<span class="sd">            The globals dictionary in which the expression should </span>
<span class="sd">            execute.</span>

<span class="sd">        operators : OperatorContext</span>
<span class="sd">            The operator context used when creating this expression.</span>
<span class="sd">            This context is entered before evaluating any code objects.</span>
<span class="sd">            This ensures that any components created by the expression</span>
<span class="sd">            share the same operator context as this expression, unless</span>
<span class="sd">            explicitly overridden.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span> <span class="o">=</span> <span class="n">identifiers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_globals</span> <span class="o">=</span> <span class="n">f_globals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operators</span> <span class="o">=</span> <span class="n">operators</span>
</div>
    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="AbstractExpression.eval"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.AbstractExpression.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Evaluates the expression and returns the result. If an </span>
<span class="sd">        expression does not provide (or cannot provide) a value, it </span>
<span class="sd">        should return NotImplemented.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : object or NotImplemented</span>
<span class="sd">            The result of evaluating the expression or NotImplemented</span>
<span class="sd">            if the expression is unable to provide a value.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="AbstractExpression.notify"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.AbstractExpression.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A method called by the owner component when the trait on </span>
<span class="sd">        which it is bound has changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        old : object</span>
<span class="sd">            The old value of the attribute.</span>
<span class="sd">        </span>
<span class="sd">        new : object</span>
<span class="sd">            The new value of the attribute.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Simple Expression</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="SimpleExpression"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SimpleExpression">[docs]</a><span class="k">class</span> <span class="nc">SimpleExpression</span><span class="p">(</span><span class="n">AbstractExpression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A concrete implementation of AbstractEvalExpression. An instance</span>
<span class="sd">    of SimpleExpression does not track changes in the expression or emit</span>
<span class="sd">    the expression_changed signal. Is also does not support notification.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SimpleExpression.eval"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SimpleExpression.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Evaluates and returns the results of the expression.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        
        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;nonlocals&#39;</span><span class="p">:</span> <span class="n">NonlocalScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">None</span><span class="p">)}</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">ExecutionScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">overrides</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span>  <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="SimpleExpression.notify"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SimpleExpression.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A no-op notification method since SimpleExpression does not</span>
<span class="sd">        support notification.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Notifification Expression</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="NotificationExpression"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NotificationExpression">[docs]</a><span class="k">class</span> <span class="nc">NotificationExpression</span><span class="p">(</span><span class="n">AbstractExpression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A concrete implementation of AbstractExpression. An instance </span>
<span class="sd">    of NotificationExpression does not support evaluation and does not</span>
<span class="sd">    emit the expression_changed signal, but it does support notification. </span>
<span class="sd">    An &#39;event&#39; object will be added to the scope of the expression which</span>
<span class="sd">    will contain information about the trait change.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#: A namedtuple which is used to pass arguments to the expression.</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;event&#39;</span><span class="p">,</span> <span class="s">&#39;obj name old new&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NotificationExpression.eval"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NotificationExpression.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A no-op eval method since NotificationExpression does not</span>
<span class="sd">        support evaluation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</div>
<div class="viewcode-block" id="NotificationExpression.notify"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.NotificationExpression.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Evaluates the underlying expression, and provides an &#39;event&#39;</span>
<span class="sd">        object in the evaluation scope which contains information about </span>
<span class="sd">        the trait change.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;event&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">),</span>
            <span class="s">&#39;nonlocals&#39;</span><span class="p">:</span> <span class="n">NonlocalScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">ExecutionScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">overrides</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Update Expression</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="UpdateExpression"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.UpdateExpression">[docs]</a><span class="k">class</span> <span class="nc">UpdateExpression</span><span class="p">(</span><span class="n">AbstractExpression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A concrete implementation of AbstractExpression which sets the </span>
<span class="sd">    value on the contituents of the expression according to any provided</span>
<span class="sd">    inverters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="UpdateExpression.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.UpdateExpression.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inverter_classes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize an UpdateExpression</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inverter_classes : iterable of AbstractInverter subclasses</span>
<span class="sd">            An iterable of concrete AbstractInverter subclasses which</span>
<span class="sd">            will invert the given expression code into a mirrored </span>
<span class="sd">            operation which sets the value on the appropriate object.</span>

<span class="sd">        args</span>
<span class="sd">            The arguments required to initialize an AbstractExpression</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UpdateExpression</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
        <span class="n">inverters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bp_code</span> <span class="o">=</span> <span class="n">Code</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">code_list</span> <span class="o">=</span> <span class="n">bp_code</span><span class="o">.</span><span class="n">code</span>

        <span class="k">for</span> <span class="n">inv_cls</span> <span class="ow">in</span> <span class="n">inverter_classes</span><span class="p">:</span>
            <span class="n">inverter</span> <span class="o">=</span> <span class="n">inv_cls</span><span class="p">()</span>
            <span class="n">new_code</span> <span class="o">=</span> <span class="n">inverter</span><span class="o">.</span><span class="n">get_inverted_code</span><span class="p">(</span><span class="n">code_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">bp_code</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">new_code</span>
                <span class="n">inverters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bp_code</span><span class="o">.</span><span class="n">to_code</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inverters</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Unable to delegate expression to the &#39;</span><span class="si">%s</span><span class="s">&#39; attribute of &quot;</span>
                   <span class="s">&quot;the </span><span class="si">%s</span><span class="s"> object. The provided expression is not structured &quot;</span>
                   <span class="s">&quot;in a way which is suitable for delegation by any of &quot;</span>
                   <span class="s">&quot;the supplied code inverters.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inverters</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inverters</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="UpdateExpression.eval"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.UpdateExpression.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A no-op eval method since UpdateExpression does not support </span>
<span class="sd">        evaluation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
</div>
<div class="viewcode-block" id="UpdateExpression.notify"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.UpdateExpression.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A notification method which runs through the list of inverted</span>
<span class="sd">        code objects which attempt to set the value. The process stops on</span>
<span class="sd">        the first successful inversion. If none of the invertors are </span>
<span class="sd">        successful, a RuntimeError is raised.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># The overrides dict is populated with information about the</span>
        <span class="c"># expression and the change. The values allow the generated</span>
        <span class="c"># inverter codes to access the information which is required</span>
        <span class="c"># to perform the operation. The items are added using names</span>
        <span class="c"># which are not valid Python identifiers and therefore do</span>
        <span class="c"># not risk clashing with names in the expression. This is</span>
        <span class="c"># the same technique used by the Python interpreter itself.</span>
        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;_[expr]&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_[obj]&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_[old]&#39;</span><span class="p">:</span> <span class="n">old</span><span class="p">,</span> <span class="s">&#39;_[new]&#39;</span><span class="p">:</span> <span class="n">new</span><span class="p">,</span> 
            <span class="s">&#39;_[name]&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;nonlocals&#39;</span><span class="p">:</span> <span class="n">NonlocalScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">ExecutionScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">overrides</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># Run through the inverters, giving each a chance to do the</span>
        <span class="c"># inversion. The process ends with the first success. If </span>
        <span class="c"># none of the invertors are successful an error is raised.</span>
        <span class="n">f_globals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_globals</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">inverter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverters</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inverter</span><span class="p">,</span> <span class="n">f_globals</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Unable to delegate expression to the </span><span class="si">%r</span><span class="s"> attribute &quot;</span>
                       <span class="s">&quot;of the </span><span class="si">%s</span><span class="s"> object. None of the provided inverters were &quot;</span>
                       <span class="s">&quot;successful in assigning the value.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Subscription Expression</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<span class="k">class</span> <span class="nc">_ImplicitAttributeBinder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A thin class which supports attaching a notifier to an implicit</span>
<span class="sd">    attribute lookup.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># This doesn&#39;t need to be provided as a monitor because implicit </span>
    <span class="c"># attribute lookups, when successful, will always be on an instance</span>
    <span class="c"># of Declarative and should never need to be hooked by an Enaml </span>
    <span class="c"># extension.</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize an _ImplicitAttributeBinder</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : SubscriptionExpression</span>
<span class="sd">            The parent SubscriptionExpression instance. Only a weak</span>
<span class="sd">            reference to the parent is stored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Binds the change handler to the given object/attribute</span>
<span class="sd">        pair, provided the attribute points to a valid trait.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Declarative</span>
<span class="sd">            The Declarative instance that owns the attribute.</span>
<span class="sd">        </span>
<span class="sd">        name : string</span>
<span class="sd">            The attribute name of interest</span>
<span class="sd">             </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Disallow</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notify</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The trait change handler callback. It calls the monitor</span>
<span class="sd">        changed method on the parent when the trait changes, provided </span>
<span class="sd">        the parent has not already been garbage collected.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">_on_monitor_changed</span><span class="p">()</span>


<div class="viewcode-block" id="SubscriptionExpression"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SubscriptionExpression">[docs]</a><span class="k">class</span> <span class="nc">SubscriptionExpression</span><span class="p">(</span><span class="n">AbstractExpression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A concrete implementation of AbstractExpression. An instance </span>
<span class="sd">    of SubcriptionExpression emits the expression_changed signal when</span>
<span class="sd">    the value of the underlying expression changes. It does not </span>
<span class="sd">    support notification.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SubscriptionExpression.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SubscriptionExpression.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monitor_classes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a SubscriptionExpression</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        monitor_classes : iterable of AbstractMonitor subclasses</span>
<span class="sd">            An iterable of AbstractMonitor subclasses which will</span>
<span class="sd">            be used to generating the monitoring code for the</span>
<span class="sd">            expression.</span>

<span class="sd">        args</span>
<span class="sd">            The arguments required to initialize an AbstractExpression</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SubscriptionExpression</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
        <span class="c"># Create the monitor instances and connect their signals</span>
        <span class="n">monitors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_monitor_changed</span>
        <span class="k">for</span> <span class="n">mcls</span> <span class="ow">in</span> <span class="n">monitor_classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">AbstractMonitor</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Monitors must be subclasses of AbstractMonitor. &#39;</span>
                       <span class="s">&#39;Got </span><span class="si">%s</span><span class="s"> instead.&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">mcls</span><span class="p">)</span>
            <span class="n">monitor</span> <span class="o">=</span> <span class="n">mcls</span><span class="p">()</span>
            <span class="n">monitor</span><span class="o">.</span><span class="n">expression_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
            <span class="n">monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monitor</span><span class="p">)</span>

        <span class="c"># Collect the generated code from the monitors that will be</span>
        <span class="c"># inserted into the code for the expression.</span>
        <span class="n">bp_code</span> <span class="o">=</span> <span class="n">Code</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">code_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bp_code</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">insertions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_insertion_code</span><span class="p">(</span><span class="n">code_list</span><span class="p">):</span>
                <span class="n">insertions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        
        <span class="c"># Create a new code list which interleaves the code generated</span>
        <span class="c"># by the monitors at the appropriate location in the expression.</span>
        <span class="n">new_code</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">code_op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">code_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">insertions</span><span class="p">:</span>
                <span class="n">new_code</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">insertions</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">new_code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code_op</span><span class="p">)</span>
        
        <span class="n">bp_code</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">new_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_code</span> <span class="o">=</span> <span class="n">bp_code</span><span class="o">.</span><span class="n">to_code</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">monitors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_binder</span> <span class="o">=</span> <span class="n">_ImplicitAttributeBinder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span> <span class="o">=</span> <span class="bp">NotImplemented</span>
</div>
    <span class="k">def</span> <span class="nf">_on_monitor_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The signal callback which is fired from a monitor when the</span>
<span class="sd">        expression changes. It will fire the expression_changed signal</span>
<span class="sd">        provided that the value of the expression has actually changed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        
        <span class="c"># Guard against exceptions being raise during comparison, such </span>
        <span class="c"># as when comparing two numpy arrays.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">different</span> <span class="o">=</span> <span class="n">new_value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">different</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">different</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

<div class="viewcode-block" id="SubscriptionExpression.eval"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SubscriptionExpression.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Evaluates the expression and returns the result. It also</span>
<span class="sd">        resets the monitors before evaluating the expression to help</span>
<span class="sd">        ensures that duplicate notifications are avoided.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Reset the monitors before every evaluation so that any old </span>
        <span class="c"># notifiers are disconnected. This avoids muti-notifications.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_binder</span> <span class="o">=</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">_ImplicitAttributeBinder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
            <span class="n">monitor</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        
        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;nonlocals&#39;</span><span class="p">:</span> <span class="n">NonlocalScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">binder</span><span class="p">)}</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">ExecutionScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">overrides</span><span class="p">,</span> <span class="n">binder</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="SubscriptionExpression.notify"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.SubscriptionExpression.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A no-op notification method since SubscriptionExpression does</span>
<span class="sd">        not support notification.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># Delegation Expression</span>
<span class="c">#------------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="DelegationExpression"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.DelegationExpression">[docs]</a><span class="k">class</span> <span class="nc">DelegationExpression</span><span class="p">(</span><span class="n">SubscriptionExpression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A SubscriptionExpression subclass that adds notification support</span>
<span class="sd">    by setting the value on the contituents of the expression according</span>
<span class="sd">    to any provide inverters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DelegationExpression.__init__"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.DelegationExpression.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inverter_classes</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a DelegationExpression</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inverter_classes : iterable of AbstractInverter subclasses</span>
<span class="sd">            An iterable of concrete AbstractInverter subclasses which</span>
<span class="sd">            will invert the given expression code into a mirrored </span>
<span class="sd">            operation which sets the value on the appropriate object.</span>

<span class="sd">        args</span>
<span class="sd">            The arguments required to initialize a SubscriptionExpression</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DelegationExpression</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
        <span class="n">inverters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bp_code</span> <span class="o">=</span> <span class="n">Code</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">code_list</span> <span class="o">=</span> <span class="n">bp_code</span><span class="o">.</span><span class="n">code</span>

        <span class="k">for</span> <span class="n">inv_cls</span> <span class="ow">in</span> <span class="n">inverter_classes</span><span class="p">:</span>
            <span class="n">inverter</span> <span class="o">=</span> <span class="n">inv_cls</span><span class="p">()</span>
            <span class="n">new_code</span> <span class="o">=</span> <span class="n">inverter</span><span class="o">.</span><span class="n">get_inverted_code</span><span class="p">(</span><span class="n">code_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">bp_code</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">new_code</span>
                <span class="n">inverters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bp_code</span><span class="o">.</span><span class="n">to_code</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inverters</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Unable to delegate expression to the &#39;</span><span class="si">%s</span><span class="s">&#39; attribute of &quot;</span>
                   <span class="s">&quot;the </span><span class="si">%s</span><span class="s"> object. The provided expression is not structured &quot;</span>
                   <span class="s">&quot;in a way which is suitable for delegation by any of &quot;</span>
                   <span class="s">&quot;the supplied code inverters.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inverters</span> <span class="o">=</span> <span class="n">inverters</span>
    </div>
<div class="viewcode-block" id="DelegationExpression.notify"><a class="viewcode-back" href="../../../api_ref/enaml.core.html#enaml.core.expressions.DelegationExpression.notify">[docs]</a>    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A notification method which runs through the list of inverted</span>
<span class="sd">        code objects which attempt to set the value. The process stops on</span>
<span class="sd">        the first successful inversion. If none of the invertors are </span>
<span class="sd">        successful, a RuntimeError is raised.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c"># We don&#39;t need to attempt the inversion if the new value</span>
        <span class="c"># is the same as the last value generated by the expression.</span>
        <span class="c"># This helps prevent bouncing back and forth which can be</span>
        <span class="c"># induced by excessive notification. Guard against exceptions</span>
        <span class="c"># being raise during comparison, such as when comparing two</span>
        <span class="c"># numpy arrays.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">different</span> <span class="o">=</span> <span class="n">new</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">different</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">different</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># The override dict is populated with information about the</span>
        <span class="c"># expression and the change. The values allow the generated</span>
        <span class="c"># inverter codes to access the information which is required</span>
        <span class="c"># to perform the operation. The items are added using names</span>
        <span class="c"># which are not valid Python identifiers and therefore do</span>
        <span class="c"># not risk clashing with names in the expression. This is</span>
        <span class="c"># the same technique used by the Python interpreter itself.</span>
        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;_[expr]&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_[obj]&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_[old]&#39;</span><span class="p">:</span> <span class="n">old</span><span class="p">,</span> <span class="s">&#39;_[new]&#39;</span><span class="p">:</span> <span class="n">new</span><span class="p">,</span> 
            <span class="s">&#39;_[name]&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;nonlocals&#39;</span><span class="p">:</span> <span class="n">NonlocalScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">ExecutionScope</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">overrides</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># Run through the inverters, giving each a chance to do the</span>
        <span class="c"># inversion. The process ends with the first success. If </span>
        <span class="c"># none of the invertors are successful an error is raised.</span>
        <span class="n">f_globals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_globals</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">inverter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverters</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inverter</span><span class="p">,</span> <span class="n">f_globals</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Unable to delegate expression to the &#39;</span><span class="si">%s</span><span class="s">&#39; attribute &quot;</span>
                       <span class="s">&quot;of the </span><span class="si">%s</span><span class="s"> object. None of the provided inverters were &quot;</span>
                       <span class="s">&quot;successful in assigning the value.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../enaml-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">enaml 0.3alpha documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
  
    <li><a href="#">enaml.core.expressions</a></li>
  

      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Enthought, Inc..
      Last updated on Sep 12, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>